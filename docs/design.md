# Hyggely 事前受取予約システム - 設計書

## 目次
1. [要件定義書](#1-要件定義書)
2. [アプリ設計書](#2-アプリ設計書)
3. [実装設計書](#3-実装設計書)

---

# 1. 要件定義書

## 1.1 プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Hyggely 事前受取予約システム |
| クライアント | Hyggely（カンパーニュ専門店） |
| 所在地 | 愛知県みよし市三好丘緑2-10-4 |
| 営業日 | 水曜日・土曜日（臨時休業/営業あり） |
| 本番URL | https://hyggely-reservation.web.app/ |
| 管理画面URL | https://hyggely-reservation.web.app/admin/login |

## 1.2 システム目的

1. 顧客が事前に商品を予約し、来店時にスムーズに受け取れる仕組みを提供
2. 店舗側の予約・在庫・顧客管理を効率化
3. Gmail通知による予約確認の自動化

## 1.3 機能要件

### 1.3.1 予約フォーム（顧客向け）

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| RF-001 | 商品選択 | 商品一覧から予約したい商品と数量を選択 |
| RF-002 | 在庫表示 | 各商品の残り在庫数をリアルタイム表示 |
| RF-003 | 受取日時選択 | 営業日カレンダーから受取日と時間帯を選択 |
| RF-004 | 個人情報入力 | 氏名・メールアドレス・電話番号・備考を入力 |
| RF-005 | 予約確認 | 入力内容を確認画面で表示 |
| RF-006 | 予約確定 | 予約をFirestoreに保存、在庫を減算 |
| RF-007 | メール送信 | 予約者・管理者へGmailで確認メールを送信 |
| RF-008 | 予約完了表示 | 予約番号と受取情報を表示 |

### 1.3.2 管理ダッシュボード

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| RD-001 | ログイン | ID・パスワードによる管理者認証 |
| RD-002 | ダッシュボードTOP | 売上サマリー・本日の予約・在庫アラート表示 |
| RD-003 | 予約管理 | 予約一覧・詳細表示・ステータス変更・キャンセル |
| RD-004 | 顧客管理 | 顧客一覧・予約履歴・顧客情報編集 |
| RD-005 | 商品管理 | 商品CRUD・在庫数設定・画像アップロード |
| RD-006 | 営業日設定 | 営業日カレンダー・臨時休業/営業設定 |
| RD-007 | 店舗設定 | 店舗情報・受取時間帯・メールテンプレート |

## 1.4 非機能要件

### 1.4.1 性能要件
- ページ読み込み: 3秒以内
- 1日あたり予約処理: 10-30件対応
- 同時接続: 10ユーザー程度

### 1.4.2 セキュリティ要件
- Firebase Authentication による管理者認証
- Firestore Security Rules による認可制御
- reCAPTCHA v3 によるボット対策
- HTTPS通信の強制
- 入力値サニタイズ・バリデーション

## 1.5 制約条件

### Firebase無料枠制限
| サービス | 無料枠 | 想定使用量/日 |
|---------|--------|--------------|
| Firestore読取 | 50,000回/日 | ~5,000回 |
| Firestore書込 | 20,000回/日 | ~500回 |
| Firestore保存 | 1GB | ~100MB |
| Hosting転送 | 360MB/日 | ~100MB |
| Functions実行 | 125,000回/月 | ~1,000回 |
| Storage | 5GB | ~1GB |

---

# 2. アプリ設計書

## 2.1 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        クライアント                          │
├─────────────────────────┬───────────────────────────────────┤
│    予約フォーム (SPA)    │     管理ダッシュボード (SPA)      │
│    React + Vite         │     React + Vite                 │
│    Tailwind CSS         │     Tailwind CSS + shadcn/ui     │
└───────────┬─────────────┴───────────────┬───────────────────┘
            │                             │
            ▼                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    Firebase Hosting                         │
└───────────────────────────┬─────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ▼               ▼               ▼
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│   Firestore   │  │ Cloud Functions│  │    Auth      │
│  (データベース) │  │ (メール送信)   │  │ (管理者認証)  │
└───────────────┘  └───────┬───────┘  └───────────────┘
                           │
                           ▼
                   ┌───────────────┐
                   │   Gmail API   │
                   │ (メール送信)   │
                   └───────────────┘
```

## 2.2 技術スタック

| レイヤー | 技術 | 理由 |
|---------|------|------|
| フロントエンド | React 18 + TypeScript | 型安全性・再利用性 |
| ビルドツール | Vite | 高速ビルド・HMR |
| UIフレームワーク | Tailwind CSS | 効率的なスタイリング |
| 状態管理 | Zustand | 軽量・シンプル |
| フォーム | React Hook Form + Zod | バリデーション |
| バックエンド | Firebase Cloud Functions | サーバーレス |
| データベース | Cloud Firestore | リアルタイム同期 |
| 認証 | Firebase Authentication | セキュア認証 |
| メール | Gmail API (OAuth 2.0) | 無料・直接送信 |
| 画像保存 | Firebase Storage | 商品画像アップロード |
| ホスティング | Firebase Hosting | 無料SSL・CDN |

## 2.3 データベース設計

### Firestoreコレクション構造

- **products**: 商品マスタ
- **reservations**: 予約データ
- **customers**: 顧客データ
- **businessDays**: 営業日設定
- **settings**: 店舗設定
- **admins**: 管理者

---

# 3. 実装設計書

## 3.1 開発環境セットアップ

### 必要ツール
- Node.js 18+
- npm または pnpm
- Firebase CLI
- Git

### セットアップコマンド
```bash
# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev

# ビルド
npm run build

# Firebaseデプロイ
firebase deploy
```

## 3.2 Firebase設定

### Firebase Console設定
1. プロジェクト作成
2. Firestore有効化（アジア北東1）
3. Authentication有効化（メール/パスワード）
4. Hosting有効化
5. Functions有効化
6. Storage有効化

### 環境変数
`.env`ファイルを作成し、Firebase設定を記入

## 3.3 実装フェーズ

### Phase 1: 基盤構築 ✅
- プロジェクト初期化
- Firebase設定
- 基本ルーティング
- 共通コンポーネント

### Phase 2: 予約フォーム（進行中）
- 商品選択画面
- 受取日時選択
- 個人情報入力
- 確認・完了画面

### Phase 3: 管理ダッシュボード
- ログイン
- ダッシュボードTOP
- 各管理画面

### Phase 4: メール通知
- Gmail API設定
- Cloud Functions実装

### Phase 5: デプロイ
- GitHub Actions設定
- 本番デプロイ
